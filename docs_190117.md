# Docs

現在までの実装に関する説明．

## x86_64 Linuxにおける，RDMAを用いた，プロセスの復元．

Linuxでは，仮想アドレス空間を実現するために，ページング機構が使用されている．
x86_64アーキテクチャにおいては，セグメント機構と，ページング機構がハードウェアで用意されているが，Linuxでは，ページング機構のみを使用している．
セグメント機構は無効にできないため，論理アドレスとリニアアドレスが等しくなるように設定されている．(フラット)

論理アドレスからリニアアドレスを算出する機構がセグメント機構

リニアアドレスから物理アドレスを算出する機構がページング機構

Linuxにおけるプロセスでは，アドレスの参照に，リニアアドレスを用いている．しかし，実際にメモリ上にアクセス(読み書き)するときは，ページング機構を通し，物理アドレスを算出している．(後述)

本研究においては，PCIeバス上で動作する`PCI-eth-bridghe`を用いる．

PCI-eth-bridgheは，物理アドレスを直接指定することで，そのアドレスから，4Byteの値を取得し，返してくれるFPGAデバイスである．

このFPGAデバイスを用いて，適切な物理アドレスを指定し，その値を本研究の実装で整理し，仮想アドレス空間(テキストセグメント，データセグメント)を復元する．

## Linuxにおけるページング機構の図示

ページング機構の起点となるのは，cr3である．これはレジスタであり，ここに，ページング機構の層のうち，もっとも上にあるテーブルのベースアドレスが格納されている．

## ページング機構の層について(64bit)

- Page Map Level 4
- Page Directory Pointer
- Page Directory
- Page Table

これらのテーブルには，512個のエントリがある，

一つのエントリのサイズは，8Byteとなっている．
そのためテーブル全体のサイズは，8Byte * 512 = 4KBである．

<!-- ここに，図を描く， -->

このエントリのうち，39-12bitに格納されている値が，次の階層のベースアドレスであり，0bitのPフラグは，当エントリの先に物理アドレスが設定されているかどうかのフラグである
